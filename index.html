<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£²é£Ÿåº—çµŒå–¶ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            overflow: hidden;
        }

        .screen {
            display: none;
            width: 100vw;
            height: 100vh;
        }

        .screen.active {
            display: flex;
        }

        /* ãƒ›ãƒ¼ãƒ ç”»é¢ */
        .home-container {
            width: 100%;
            max-width: 500px;
            margin: auto;
            text-align: center;
            padding: 40px 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .home-container h1 {
            margin-bottom: 30px;
            color: #2c3e50;
            font-size: 2.5em;
        }

        .home-container button {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 15px 0;
            font-size: 18px;
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .home-container button:hover {
            transform: translateY(-2px);
        }

        .difficulty-selector {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .difficulty-selector select {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border: 2px solid #bdc3c7;
            border-radius: 5px;
            font-size: 16px;
        }

        /* è¨­å®šç”»é¢ */
        .setup-container {
            width: 100%;
            max-width: 800px;
            margin: auto;
            padding: 40px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .setup-container h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
            font-size: 2em;
        }

        .setup-step h3 {
            margin-bottom: 20px;
            text-align: center;
            color: #34495e;
        }

        .button-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .button-group button {
            padding: 25px;
            font-size: 18px;
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .button-group button:hover {
            transform: translateY(-3px);
        }

        .seat-selection {
            text-align: center;
            margin: 30px 0;
            font-size: 1.5em;
        }

        .seat-selection button {
            padding: 15px 25px;
            font-size: 1.2em;
            margin: 0 15px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }

        .menu-item {
            padding: 20px;
            background: #ecf0f1;
            border: 3px solid #95a5a6;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .menu-item.selected {
            background: #2ecc71;
            color: white;
            border-color: #27ae60;
            transform: scale(1.05);
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .navigation button {
            padding: 12px 25px;
            font-size: 16px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        #startBtn {
            background: #27ae60;
        }

        /* ã‚²ãƒ¼ãƒ ç”»é¢ */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            background: #2c3e50;
            color: white;
        }

        .game-header button {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            cursor: pointer;
        }

        .game-info {
            display: flex;
            gap: 30px;
            font-size: 1.1em;
        }

        .game-main {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            height: calc(100vh - 70px);
            gap: 15px;
            padding: 15px;
            background: #ecf0f1;
        }

        .panel {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
        }

        /* å¸­è¡¨ç¤º */
        .seats-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 15px;
        }

        .seat {
            padding: 15px;
            background: #ecf0f1;
            border-radius: 10px;
            text-align: center;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .seat.occupied {
            background: #f39c12;
            color: white;
        }

        .seat.available {
            background: #27ae60;
            color: white;
        }

        .seat.waiting {
            background: #e74c3c;
            color: white;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        /* ã‚²ãƒ¼ãƒ ãƒ“ãƒ¥ãƒ¼ */
        .game-view {
            display: flex;
            flex-direction: column;
        }

        .customer-view {
            flex: 1;
            background: #8e44ad;
            border-radius: 12px;
            margin-bottom: 15px;
            position: relative;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .quick-actions button {
            padding: 12px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        /* ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— */
        .popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
        }

        .customer-order {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
        }

        .customer-image {
            width: 100px;
            height: 100px;
            background: #74b9ff;
            border-radius: 50%;
            margin-right: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2em;
        }

        .speech-bubble {
            flex: 1;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 20px;
            border: 2px solid #e9ecef;
        }

        .order-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .order-buttons button {
            padding: 15px;
            background: #00b894;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }

        .order-time {
            text-align: center;
            margin: 15px 0;
            font-size: 1.2em;
            color: #e74c3c;
            font-weight: bold;
        }

        /* ã‚·ãƒ§ãƒƒãƒ—ç³» */
        .shop-items, .promotion-options, .staff-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 20px 0;
        }

        .shop-item, .promotion-option, .staff-option {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px solid #e9ecef;
            text-align: center;
        }

        .shop-item button, .promotion-option button, .staff-option button {
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        /* é€šçŸ¥ */
        .notification {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateX(-50%) translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 768px) {
            .game-main {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto;
            }
            
            .button-group {
                grid-template-columns: 1fr;
            }
            
            .popup {
                width: 95%;
            }
            
            .shop-items, .promotion-options, .staff-options {
                grid-template-columns: 1fr;
            }
            
            .order-buttons {
                grid-template-columns: 1fr;
            }
        }

        /* ã‚¹ãƒãƒ›ãƒ¢ãƒ¼ãƒ‰ */
        .mobile-mode .game-main {
            grid-template-columns: 1fr;
            grid-template-rows: auto 1fr auto;
        }

        .mobile-mode .shop-info,
        .mobile-mode .stats-info {
            display: none;
        }

        /* è¨­å®šé …ç›® */
        .setting-item {
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼/ã‚¯ãƒªã‚¢ */
        #gameOver {
            background: #e74c3c;
            color: white;
            text-align: center;
        }

        #gameClear {
            background: #27ae60;
            color: white;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- ãƒ›ãƒ¼ãƒ ç”»é¢ -->
    <div id="homeScreen" class="screen active">
        <div class="home-container">
            <h1>é£²é£Ÿåº—çµŒå–¶ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h1>
            <button onclick="startNewGame()">ã‚²ãƒ¼ãƒ ã‚’å§‹ã‚ã‚‹</button>
            <button onclick="loadGame()">ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€</button>
            <button onclick="window.open('https://tamani3901.github.io/ti-tobann/', '_blank')">ãƒãƒ¼ãƒˆã‚¨ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã¸</button>
            <div class="difficulty-selector">
                <h3>é›£æ˜“åº¦é¸æŠ</h3>
                <select id="difficultySelect">
                    <option value="easy">ç°¡å˜</option>
                    <option value="normal" selected>æ™®é€š</option>
                    <option value="hard">é›£ã—ã„</option>
                </select>
            </div>
        </div>
    </div>

    <!-- ã‚²ãƒ¼ãƒ è¨­å®šç”»é¢ -->
    <div id="setupScreen" class="screen">
        <div class="setup-container">
            <h2>åº—èˆ—è¨­å®š</h2>
            <div class="setup-step" id="step1">
                <h3>åº—ã®ç¨®é¡ã‚’é¸æŠ</h3>
                <div class="button-group">
                    <button onclick="selectStoreType('fastfood')">ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆãƒ•ãƒ¼ãƒ‰</button>
                    <button onclick="selectStoreType('restaurant')">ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³</button>
                </div>
            </div>

            <div class="setup-step" id="step2" style="display:none;">
                <h3>å ´æ‰€ã‚’é¸æŠ</h3>
                <div class="button-group">
                    <button onclick="selectLocation('metropolis')">å¤§éƒ½å¸‚</button>
                    <button onclick="selectLocation('city')">éƒ½å¸‚éƒ¨</button>
                    <button onclick="selectLocation('medium')">ä¸­éƒ½å¸‚</button>
                    <button onclick="selectLocation('small')">å°éƒ½å¸‚</button>
                </div>
            </div>

            <div class="setup-step" id="step3" style="display:none;">
                <h3>å¸­æ•°ã‚’é¸æŠ</h3>
                <div class="seat-selection">
                    <button onclick="changeSeats(-2)">-</button>
                    <span id="seatCount">4</span>å¸­
                    <button onclick="changeSeats(2)">+</button>
                </div>
                <p id="seatPrice">ä¾¡æ ¼: 200ä¸‡å††</p>
                <p id="seatLimit">æœ€å¤§: 4å¸­</p>
            </div>

            <div class="setup-step" id="step4" style="display:none;">
                <h3>åˆæœŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸æŠ (5ã¤ã¾ã§)</h3>
                <div id="menuSelection" class="menu-grid"></div>
                <p>é¸æŠæ¸ˆã¿: <span id="selectedCount">0</span>/5</p>
            </div>

            <div class="navigation">
                <button onclick="previousStep()" id="prevBtn" style="display:none;">æˆ»ã‚‹</button>
                <button onclick="nextStep()" id="nextBtn" style="display:none;">æ¬¡ã¸</button>
                <button onclick="startGame()" id="startBtn" style="display:none;">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
            </div>
        </div>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ç”»é¢ -->
    <div id="gameScreen" class="screen">
        <div class="game-header">
            <button id="menuBtn" onclick="toggleMenu()">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</button>
            <button id="settingsBtn" onclick="toggleSettings()">è¨­å®š</button>
            <div class="game-info">
                <div id="timeDisplay">09:00 æœˆæ›œæ—¥</div>
                <div id="moneyDisplay">Â¥15,000,000</div>
                <div id="ratingDisplay">è©•ä¾¡: â˜…â˜…â˜…â˜…â˜…</div>
            </div>
            <button id="modeToggle" onclick="toggleMode()">PCãƒ¢ãƒ¼ãƒ‰</button>
        </div>

        <div class="game-main">
            <div class="shop-info panel">
                <h3>å¸­æƒ…å ±</h3>
                <div id="seatsContainer" class="seats-container"></div>
                
                <h3>å¾“æ¥­å“¡æƒ…å ±</h3>
                <div id="staffInfo" class="staff-info"></div>
                
                <h3>ã‚¢ã‚¤ãƒ†ãƒ </h3>
                <div id="itemsInfo" class="items-info"></div>
            </div>

            <div class="game-view panel">
                <div id="customerView" class="customer-view"></div>
                <div id="notification" class="notification"></div>
                <div class="quick-actions">
                    <button onclick="showItemShop()">ã‚¢ã‚¤ãƒ†ãƒ è³¼å…¥</button>
                    <button onclick="showPromotionMenu()">å®£ä¼æ´»å‹•</button>
                    <button onclick="hireStaff()">å¾“æ¥­å“¡é›‡ç”¨</button>
                </div>
            </div>

            <div class="stats-info panel">
                <h3>åº—èˆ—çµ±è¨ˆ</h3>
                <div id="dayDisplay">1æ—¥ç›®</div>
                <div id="satisfactionDisplay">å¹³å‡æº€è¶³åº¦: 100%</div>
                <div id="dailyProfit">æœ¬æ—¥ã®åˆ©ç›Š: Â¥0</div>
                <div id="totalCustomers">ç·å®¢æ•°: 0</div>
                <div id="successRate">æˆåŠŸç‡: 100%</div>
                
                <h3>å®£ä¼åŠ¹æœ</h3>
                <div id="promotionEffects"></div>
                
                <h3>ç›®æ¨™</h3>
                <div id="goalDisplay"></div>
            </div>
        </div>

        <!-- å„ç¨®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
        <div id="popupMenu" class="popup" style="display:none;">
            <h3>ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h3>
            <button onclick="saveGame()">ã‚²ãƒ¼ãƒ ã‚’ã‚»ãƒ¼ãƒ–</button>
            <button onclick="togglePause()" id="pauseBtn">ä¸€æ™‚åœæ­¢</button>
            <button onclick="showSettings()">è¨­å®š</button>
            <button onclick="exitGame()">ã‚²ãƒ¼ãƒ ã‚’çµ‚äº†</button>
            <button onclick="toggleMenu()">é–‰ã˜ã‚‹</button>
        </div>

        <div id="settingsMenu" class="popup" style="display:none;">
            <h3>è¨­å®š</h3>
            <div class="setting-item">
                <label>æ³¨æ–‡æ–¹å¼:</label>
                <select id="orderMode">
                    <option value="mixed">æ··åˆ</option>
                    <option value="manual">æ‰‹å‹•ã®ã¿</option>
                    <option value="auto">è‡ªå‹•ã®ã¿</option>
                </select>
            </div>
            <div class="setting-item">
                <label>ã‚²ãƒ¼ãƒ é€Ÿåº¦:</label>
                <select id="gameSpeed">
                    <option value="1">é€šå¸¸</option>
                    <option value="2">é€Ÿã„</option>
                    <option value="3">æœ€é€Ÿ</option>
                </select>
            </div>
            <button onclick="applySettings()">é©ç”¨</button>
            <button onclick="toggleSettings()">é–‰ã˜ã‚‹</button>
        </div>

        <div id="orderPopup" class="popup" style="display:none;">
            <div class="customer-order">
                <div id="customerImage" class="customer-image">ğŸ‘¨</div>
                <div id="orderSpeech" class="speech-bubble">æ³¨æ–‡ã‚’ãŠé¡˜ã„ã—ã¾ã™ï¼</div>
            </div>
            <div id="orderButtons" class="order-buttons"></div>
            <div class="order-time">å¾…æ©Ÿæ™‚é–“: <span id="waitTime">0</span>ç§’</div>
            <button onclick="closeOrder()">æ³¨æ–‡ã‚’å®Œäº†</button>
        </div>

        <div id="itemShop" class="popup" style="display:none;">
            <h3>ã‚¢ã‚¤ãƒ†ãƒ è³¼å…¥</h3>
            <div class="shop-items">
                <div class="shop-item">
                    <h4>ã‚´ãƒŸç®±</h4>
                    <p>å®¢ã®æº€è¶³åº¦ãŒå‘ä¸Š</p>
                    <p>ä¾¡æ ¼: Â¥10,000</p>
                    <button onclick="buyItem('trashBin')">è³¼å…¥</button>
                </div>
                <div class="shop-item">
                    <h4>æ¸…æƒä½œæ¥­</h4>
                    <p>åº—ã®è©•ä¾¡ãŒ0.2å‘ä¸Š</p>
                    <p>ä¾¡æ ¼: Â¥50,000</p>
                    <button onclick="buyItem('cleaning')">è³¼å…¥</button>
                </div>
            </div>
            <button onclick="closeItemShop()">é–‰ã˜ã‚‹</button>
        </div>

        <div id="promotionMenu" class="popup" style="display:none;">
            <h3>å®£ä¼æ´»å‹•</h3>
            <div class="promotion-options">
                <div class="promotion-option">
                    <h4>ãƒã‚¹ã‚¿ãƒ¼ã‚’è²¼ã‚‹</h4>
                    <p>åŠ¹æœ: å®¢ãŒ15%å¢—åŠ  (2æ—¥é–“)</p>
                    <p>è²»ç”¨: Â¥7,000</p>
                    <button onclick="startPromotion('poster')">å®Ÿæ–½</button>
                </div>
                <div class="promotion-option">
                    <h4>ãƒãƒ©ã‚·ã‚’é…ã‚‹</h4>
                    <p>åŠ¹æœ: å®¢ãŒ20%å¢—åŠ  (2æ—¥é–“)</p>
                    <p>è²»ç”¨: Â¥10,000</p>
                    <button onclick="startPromotion('flyer')">å®Ÿæ–½</button>
                </div>
                <div class="promotion-option">
                    <h4>CMæ”¾é€</h4>
                    <p>åŠ¹æœ: å®¢ãŒ25%å¢—åŠ  (10æ—¥é–“)</p>
                    <p>è²»ç”¨: Â¥50,000</p>
                    <button onclick="startPromotion('cm')">å®Ÿæ–½</button>
                </div>
            </div>
            <button onclick="closePromotionMenu()">é–‰ã˜ã‚‹</button>
        </div>

        <div id="staffHire" class="popup" style="display:none;">
            <h3>å¾“æ¥­å“¡é›‡ç”¨</h3>
            <div class="staff-options">
                <div class="staff-option">
                    <h4>ãƒãƒ³ã‚³ãƒ„</h4>
                    <p>é€Ÿåº¦: 0.5å€</p>
                    <p>çµ¦æ–™: Â¥100,000</p>
                    <button onclick="hireStaffType('rookie')">é›‡ç”¨</button>
                </div>
                <div class="staff-option">
                    <h4>æ¨™æº–</h4>
                    <p>é€Ÿåº¦: 1.0å€</p>
                    <p>çµ¦æ–™: Â¥200,000</p>
                    <button onclick="hireStaffType('normal')">é›‡ç”¨</button>
                </div>
                <div class="staff-option">
                    <h4>ãƒ™ãƒ†ãƒ©ãƒ³</h4>
                    <p>é€Ÿåº¦: 1.6å€</p>
                    <p>çµ¦æ–™: Â¥300,000</p>
                    <button onclick="hireStaffType('veteran')">é›‡ç”¨</button>
                </div>
            </div>
            <button onclick="closeStaffHire()">é–‰ã˜ã‚‹</button>
        </div>

        <div id="gameOver" class="popup" style="display:none;">
            <h3>ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼</h3>
            <div id="gameOverMessage"></div>
            <button onclick="returnToHome()">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
        </div>

        <div id="gameClear" class="popup" style="display:none;">
            <h3>ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢ï¼</h3>
            <div id="clearMessage"></div>
            <button onclick="returnToHome()">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
            <button onclick="continuePlaying()">ç¶šã‘ã¦éŠã¶</button>
        </div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        let gameState = {
            currentScreen: 'home',
            storeType: null,
            location: null,
            seats: 4,
            selectedMenus: [],
            money: 15000000,
            time: { hour: 9, minute: 0, day: 1, weekday: 0 },
            rating: 5,
            satisfaction: 100,
            staff: [],
            customers: [],
            items: [],
            promotions: [],
            isPaused: false,
            difficulty: 'normal',
            totalCustomers: 0,
            successfulOrders: 0,
            dailyProfit: 0,
            isMobileMode: false,
            gameSpeed: 1
        };

        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿
        const menuData = {
            fastfood: {
                'ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼': { price: 500, variants: ['ãƒãƒ¼ã‚ºãƒãƒ¼ã‚¬ãƒ¼', 'ãƒ†ãƒªãƒ¤ã‚­ãƒãƒ¼ã‚¬ãƒ¼', 'ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼', 'ç„¼è‚‰ãƒ©ã‚¤ã‚¹ãƒãƒ¼ã‚¬ãƒ¼'] },
                'ãƒãƒ†ãƒˆ': { price: 300, variants: ['Sã‚µã‚¤ã‚º', 'Mã‚µã‚¤ã‚º', 'Lã‚µã‚¤ã‚º'] },
                'ãƒŠã‚²ãƒƒãƒˆ': { price: 300, variants: ['ãƒŠã‚²ãƒƒãƒˆ'] },
                'ã‚·ã‚§ã‚¤ã‚¯': { price: 300, variants: ['ãƒãƒ‹ãƒ©ã‚·ã‚§ã‚¤ã‚¯', 'ã„ã¡ã”ã‚·ã‚§ã‚¤ã‚¯'] },
                'ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ã‚»ãƒƒãƒˆ': { price: 700, variants: ['å„ç¨®ã‚»ãƒƒãƒˆ'] },
                'ãƒãƒ†ãƒˆã‚»ãƒƒãƒˆ': { price: 600, variants: ['ãƒãƒ†ãƒˆã‚»ãƒƒãƒˆ'] },
                'ã‚¸ãƒ¥ãƒ¼ã‚¹': { price: 300, variants: ['ã‚ªãƒ¬ãƒ³ã‚¸ã‚¸ãƒ¥ãƒ¼ã‚¹', 'ãƒªãƒ³ã‚´ã‚¸ãƒ¥ãƒ¼ã‚¹', 'ã‚³ãƒ¼ãƒ©', 'ãƒ¡ãƒ­ãƒ³ã‚½ãƒ¼ãƒ€'] }
            },
            restaurant: {
                'ãƒ”ã‚¶': { price: 1200, variants: ['ãƒãƒ«ã‚²ãƒªãƒ¼ã‚¿', 'ãƒãƒ¼ã‚ºãƒ”ã‚¶'] },
                'ã‚¹ãƒ‘ã‚²ãƒƒãƒ†ã‚£ãƒ¼': { price: 1000, variants: ['ãƒŠãƒãƒªã‚¿ãƒ³ãƒ‘ã‚¹ã‚¿', 'ãƒˆãƒãƒˆãƒ‘ã‚¹ã‚¿', 'ã‚«ãƒ«ãƒœãƒŠãƒ¼ãƒ©'] },
                'ã‚¸ãƒ¥ãƒ¼ã‚¹': { price: 300, variants: ['ã‚ªãƒ¬ãƒ³ã‚¸ã‚¸ãƒ¥ãƒ¼ã‚¹', 'ãƒªãƒ³ã‚´ã‚¸ãƒ¥ãƒ¼ã‚¹', 'ã‚«ãƒ«ãƒ”ã‚¹', 'ã‚³ãƒ¼ãƒ©', 'ãƒ¡ãƒ­ãƒ³ã‚½ãƒ¼ãƒ€'] },
                'ãƒ‘ãƒ³ã‚±ãƒ¼ã‚­': { price: 900, variants: ['ãƒ‘ãƒ³ã‚±ãƒ¼ã‚­'] },
                'ãƒãƒ³ãƒãƒ¼ã‚°': { price: 1300, variants: ['ãƒãƒ³ãƒãƒ¼ã‚°'] },
                'ã‚¹ãƒ†ãƒ¼ã‚­': { price: 1400, variants: ['ã‚¹ãƒ†ãƒ¼ã‚­'] },
                'ã‚µãƒ©ãƒ€': { price: 500, variants: ['ã‚µãƒ©ãƒ€'] },
                'ãƒãƒ†ãƒˆ': { price: 400, variants: ['ãƒãƒ†ãƒˆ'] },
                'ãƒ‘ãƒ•ã‚§': { price: 700, variants: ['ãƒ‘ãƒ•ã‚§'] },
                'ãƒ—ãƒªãƒ³': { price: 400, variants: ['ãƒ—ãƒªãƒ³'] },
                'ã”é£¯': { price: 350, variants: ['ã”é£¯'] }
            }
        };

        // å ´æ‰€ãƒ‡ãƒ¼ã‚¿
        const locationData = {
            metropolis: { name: 'å¤§éƒ½å¸‚', maxSeats: 10, seatPrice: 3000000 },
            city: { name: 'éƒ½å¸‚éƒ¨', maxSeats: 8, seatPrice: 3000000 },
            medium: { name: 'ä¸­éƒ½å¸‚', maxSeats: 6, seatPrice: 2000000 },
            small: { name: 'å°éƒ½å¸‚', maxSeats: 4, seatPrice: 2000000 }
        };

        // å¾“æ¥­å“¡ãƒ‡ãƒ¼ã‚¿
        const staffData = {
            rookie: { name: 'ãƒãƒ³ã‚³ãƒ„', speed: 0.5, salary: 100000, hireCost: 100000 },
            normal: { name: 'æ¨™æº–', speed: 1.0, salary: 200000, hireCost: 200000 },
            veteran: { name: 'ãƒ™ãƒ†ãƒ©ãƒ³', speed: 1.6, salary: 300000, hireCost: 300000 },
            master: { name: 'ãƒã‚¹ã‚¿ãƒ¼', speed: 2.5, salary: 500000, hireCost: 500000 }
        };

        // æ›œæ—¥ãƒ‡ãƒ¼ã‚¿
        const weekdays = ['æœˆæ›œæ—¥', 'ç«æ›œæ—¥', 'æ°´æ›œæ—¥', 'æœ¨æ›œæ—¥', 'é‡‘æ›œæ—¥', 'åœŸæ›œæ—¥', 'æ—¥æ›œæ—¥'];

        // ã‚²ãƒ¼ãƒ å¤‰æ•°
        let gameInterval;
        let currentOrderCustomer = null;

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initGame();
        });

        function initGame() {
            updateDisplays();
            gameState.isMobileMode = window.innerWidth < 768;
            updateDisplayMode();
        }

        // ã‚¹ã‚¯ãƒªãƒ¼ãƒ³åˆ‡ã‚Šæ›¿ãˆ
        function showScreen(screenName) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenName + 'Screen').classList.add('active');
            gameState.currentScreen = screenName;
        }

        // æ–°ã—ã„ã‚²ãƒ¼ãƒ é–‹å§‹
        function startNewGame() {
            gameState.difficulty = document.getElementById('difficultySelect').value;
            gameState = {
                currentScreen: 'setup',
                storeType: null,
                location: null,
                seats: 4,
                selectedMenus: [],
                money: 15000000,
                time: { hour: 9, minute: 0, day: 1, weekday: 0 },
                rating: 5,
                satisfaction: 100,
                staff: [],
                customers: [],
                items: [],
                promotions: [],
                isPaused: false,
                difficulty: gameState.difficulty,
                totalCustomers: 0,
                successfulOrders: 0,
                dailyProfit: 0,
                isMobileMode: gameState.isMobileMode,
                gameSpeed: 1
            };
            showScreen('setup');
            showStep(1);
        }

        // è¨­å®šã‚¹ãƒ†ãƒƒãƒ—ç®¡ç†
        let currentStep = 1;

        function showStep(step) {
            document.querySelectorAll('.setup-step').forEach(el => {
                el.style.display = 'none';
            });
            document.getElementById('step' + step).style.display = 'block';
            
            document.getElementById('prevBtn').style.display = step > 1 ? 'inline-block' : 'none';
            document.getElementById('nextBtn').style.display = step < 4 ? 'inline-block' : 'none';
            document.getElementById('startBtn').style.display = step === 4 ? 'inline-block' : 'none';
            
            currentStep = step;
            updateStepContent();
        }

        function nextStep() {
            if (validateStep(currentStep)) {
                if (currentStep < 4) {
                    showStep(currentStep + 1);
                }
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                showStep(currentStep - 1);
            }
        }

        function validateStep(step) {
            switch(step) {
                case 1:
                    if (!gameState.storeType) {
                        alert('åº—ã®ç¨®é¡ã‚’é¸æŠã—ã¦ãã ã•ã„');
                        return false;
                    }
                    break;
                case 2:
                    if (!gameState.location) {
                        alert('å ´æ‰€ã‚’é¸æŠã—ã¦ãã ã•ã„');
                        return false;
                    }
                    break;
                case 4:
                    if (gameState.selectedMenus.length === 0) {
                        alert('ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„');
                        return false;
                    }
                    break;
            }
            return true;
        }

        // åº—èˆ—ç¨®é¡é¸æŠ
        function selectStoreType(type) {
            gameState.storeType = type;
            document.querySelectorAll('.button-group button').forEach(btn => {
                btn.style.background = '';
            });
            event.target.style.background = '#27ae60';
            updateStepContent();
        }

        // å ´æ‰€é¸æŠ
        function selectLocation(loc) {
            gameState.location = loc;
            gameState.seats = locationData[loc].maxSeats;
            document.querySelectorAll('.button-group button').forEach(btn => {
                btn.style.background = '';
            });
            event.target.style.background = '#27ae60';
            updateStepContent();
        }

        // å¸­æ•°å¤‰æ›´
        function changeSeats(delta) {
            const maxSeats = locationData[gameState.location].maxSeats;
            const newSeats = gameState.seats + delta;
            if (newSeats >= 2 && newSeats <= maxSeats && newSeats % 2 === 0) {
                gameState.seats = newSeats;
                updateStepContent();
            }
        }

        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼é¸æŠ
        function toggleMenuSelection(menu) {
            const index = gameState.selectedMenus.indexOf(menu);
            if (index > -1) {
                gameState.selectedMenus.splice(index, 1);
            } else if (gameState.selectedMenus.length < 5) {
                gameState.selectedMenus.push(menu);
            }
            updateStepContent();
        }

        // ã‚¹ãƒ†ãƒƒãƒ—å†…å®¹æ›´æ–°
        function updateStepContent() {
            if (currentStep === 3 && gameState.location) {
                document.getElementById('seatCount').textContent = gameState.seats;
                const seatPrice = locationData[gameState.location].seatPrice;
                document.getElementById('seatPrice').textContent = 
                    `ä¾¡æ ¼: ${(seatPrice / 10000).toLocaleString()}ä¸‡å††`;
                document.getElementById('seatLimit').textContent = 
                    `æœ€å¤§: ${locationData[gameState.location].maxSeats}å¸­`;
            }
            
            if (currentStep === 4 && gameState.storeType) {
                const menuContainer = document.getElementById('menuSelection');
                menuContainer.innerHTML = '';
                
                const menus = menuData[gameState.storeType];
                for (const [category, data] of Object.entries(menus)) {
                    const menuItem = document.createElement('div');
                    menuItem.className = `menu-item ${gameState.selectedMenus.includes(category) ? 'selected' : ''}`;
                    menuItem.innerHTML = `
                        <div>${category}</div>
                        <small>Â¥${data.price}ï½</small>
                    `;
                    menuItem.onclick = () => toggleMenuSelection(category);
                    menuContainer.appendChild(menuItem);
                }
                
                document.getElementById('selectedCount').textContent = gameState.selectedMenus.length;
            }
        }

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        function startGame() {
            if (gameState.selectedMenus.length === 0) {
                alert('ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            const seatCost = locationData[gameState.location].seatPrice;
            const storeCost = 3000000;
            gameState.money -= seatCost + storeCost;
            
            showScreen('game');
            startGameLoop();
            updateGameDisplay();
        }

        // ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—
        function startGameLoop() {
            if (gameInterval) clearInterval(gameInterval);
            
            const realTimePerGameMinute = 1000 / gameState.gameSpeed;
            gameInterval = setInterval(() => {
                if (!gameState.isPaused) {
                    updateGameTime();
                    updateCustomers();
                    updateGameDisplay();
                    checkGameConditions();
                }
            }, realTimePerGameMinute);
        }

        // ã‚²ãƒ¼ãƒ æ™‚é–“æ›´æ–°
        function updateGameTime() {
            gameState.time.minute++;
            if (gameState.time.minute >= 60) {
                gameState.time.minute = 0;
                gameState.time.hour++;
                
                if (gameState.time.hour >= 22) {
                    endDay();
                }
            }
        }

        // æ—¥ã®çµ‚äº†å‡¦ç†
        function endDay() {
            paySalaries();
            
            if (gameState.day % 10 === 0) {
                gameState.money -= 1000000;
                showNotification('å®¶è³ƒãƒ»å…‰ç†±è²» Â¥1,000,000 ã‚’æ”¯æ‰•ã„ã¾ã—ãŸ');
            }
            
            gameState.day++;
            gameState.time.hour = 9;
            gameState.time.minute = 0;
            gameState.time.weekday = (gameState.time.weekday + 1) % 7;
            gameState.dailyProfit = 0;
            
            gameState.customers = [];
            
            if (gameState.money < 2000000 && !gameState.receivedSupport) {
                gameState.money += 5000000;
                gameState.receivedSupport = true;
                showNotification('è³‡é‡‘ä¸è¶³ã®ãŸã‚ Â¥5,000,000 ã®æ”¯æ´ã‚’å—ã‘ã¾ã—ãŸ');
            }
            
            updatePromotions();
        }

        // çµ¦æ–™æ”¯æ‰•ã„
        function paySalaries() {
            let totalSalary = 0;
            gameState.staff.forEach(staff => {
                totalSalary += staff.salary;
            });
            
            if (totalSalary > 0) {
                gameState.money -= totalSalary;
                gameState.dailyProfit -= totalSalary;
                showNotification(`çµ¦æ–™ Â¥${totalSalary.toLocaleString()} ã‚’æ”¯æ‰•ã„ã¾ã—ãŸ`);
            }
        }

        // å®¢ã®æ›´æ–°
        function updateCustomers() {
            if (Math.random() < getCustomerSpawnRate()) {
                spawnCustomer();
            }
            
            gameState.customers.forEach((customer, index) => {
                updateCustomerState(customer, index);
            });
            
            assignWaitingCustomers();
        }

        // å®¢ã®ã‚¹ãƒãƒ¼ãƒ³ç‡è¨ˆç®—
        function getCustomerSpawnRate() {
            let rate = 0.1;
            
            const hour = gameState.time.hour;
            if (hour >= 11 && hour <= 13) {
                rate *= 1.3;
            }
            
            if (gameState.time.weekday >= 5) {
                rate *= 1.2;
            }
            
            if (gameState.rating < 2.5) rate *= 0.6;
            else if (gameState.rating < 3.5) rate *= 0.8;
            
            gameState.promotions.forEach(promo => {
                if (promo.active) rate *= 1.25;
            });
            
            return rate;
        }

        // æ–°è¦å®¢ã‚¹ãƒãƒ¼ãƒ³
        function spawnCustomer() {
            const groupSize = Math.floor(Math.random() * 4) + 1;
            const availableSeats = getAvailableSeats();
            
            if (availableSeats >= groupSize) {
                const customer = {
                    id: Date.now() + Math.random(),
                    groupSize: groupSize,
                    state: 'waiting',
                    order: null,
                    orderTime: null,
                    satisfaction: 100,
                    seatIndex: -1,
                    orderType: Math.random() < 0.5 ? 'tablet' : 'manual'
                };
                
                gameState.customers.push(customer);
                assignSeatToCustomer(customer);
            }
        }

        // åˆ©ç”¨å¯èƒ½ãªå¸­æ•°ã‚’å–å¾—
        function getAvailableSeats() {
            let occupiedSeats = 0;
            gameState.customers.forEach(customer => {
                if (customer.seatIndex !== -1) {
                    occupiedSeats += customer.groupSize;
                }
            });
            return gameState.seats - occupiedSeats;
        }

        // å®¢ã«å¸­ã‚’å‰²ã‚Šå½“ã¦
        function assignSeatToCustomer(customer) {
            if (customer.state === 'waiting' && customer.seatIndex === -1) {
                const availableSeats = getAvailableSeats();
                if (availableSeats >= customer.groupSize) {
                    customer.state = 'seated';
                    customer.seatIndex = findAvailableSeatIndex();
                    
                    if (customer.orderType === 'tablet') {
                        setTimeout(() => processTabletOrder(customer), 1000);
                    } else {
                        customer.state = 'ordering';
                        if (!currentOrderCustomer) {
                            showOrderPopup(customer);
                        }
                    }
                }
            }
        }

        // å¾…æ©Ÿä¸­ã®å®¢ã‚’ç€å¸­ã•ã›ã‚‹
        function assignWaitingCustomers() {
            gameState.customers.forEach(customer => {
                if (customer.state === 'waiting' && customer.seatIndex === -1) {
                    assignSeatToCustomer(customer);
                }
            });
        }

        // åˆ©ç”¨å¯èƒ½ãªå¸­ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ¤œç´¢
        function findAvailableSeatIndex() {
            const occupiedIndices = gameState.customers
                .filter(c => c.seatIndex !== -1)
                .map(c => c.seatIndex);
            
            for (let i = 0; i < gameState.seats; i++) {
                if (!occupiedIndices.includes(i)) {
                    return i;
                }
            }
            return -1;
        }

        // ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆæ³¨æ–‡å‡¦ç†
        function processTabletOrder(customer) {
            if (customer.state === 'seated') {
                customer.state = 'ordering';
                customer.order = generateRandomOrder();
                customer.orderTime = Date.now();
                
                const cookTime = calculateCookTime(customer.order);
                setTimeout(() => {
                    serveOrder(customer);
                }, cookTime);
            }
        }

        // ãƒ©ãƒ³ãƒ€ãƒ æ³¨æ–‡ç”Ÿæˆ
        function generateRandomOrder() {
            const order = [];
            const menuCount = Math.floor(Math.random() * 3) + 1;
            
            for (let i = 0; i < menuCount; i++) {
                const availableMenus = gameState.selectedMenus.filter(menu => 
                    menuData[gameState.storeType][menu]
                );
                
                if (availableMenus.length > 0) {
                    const randomMenu = availableMenus[Math.floor(Math.random() * availableMenus.length)];
                    const menuDataItem = menuData[gameState.storeType][randomMenu];
                    const variant = menuDataItem.variants[Math.floor(Math.random() * menuDataItem.variants.length)];
                    
                    order.push({
                        menu: randomMenu,
                        variant: variant,
                        price: menuDataItem.price
                    });
                }
            }
            
            return order;
        }

        // èª¿ç†æ™‚é–“è¨ˆç®—
        function calculateCookTime(order) {
            let baseTime = order.length * 10000;
            let staffMultiplier = 1.0;
            
            if (gameState.staff.length > 0) {
                staffMultiplier = gameState.staff.reduce((acc, staff) => {
                    return Math.min(acc, staffData[staff.type].speed);
                }, 1);
            }
            
            return baseTime / staffMultiplier;
        }

        // æ³¨æ–‡æä¾›
        function serveOrder(customer) {
            if (customer.state === 'ordering') {
                customer.state = 'eating';
                
                const serveTime = (Date.now() - customer.orderTime) / 1000;
                customer.satisfaction = calculateSatisfaction(serveTime);
                
                const eatTime = 30000;
                setTimeout(() => {
                    completeCustomerVisit(customer);
                }, eatTime);
            }
        }

        // æº€è¶³åº¦è¨ˆç®—
        function calculateSatisfaction(serveTime) {
            if (serveTime <= 4) return 100;
            if (serveTime <= 6.25) return 75;
            if (serveTime <= 10) return 60;
            if (serveTime <= 20) return 45;
            return 30;
        }

        // å®¢ã®è¨ªå•å®Œäº†
        function completeCustomerVisit(customer) {
            if (customer.state === 'eating') {
                const total = customer.order.reduce((sum, item) => sum + item.price, 0);
                gameState.money += total;
                gameState.dailyProfit += total;
                gameState.totalCustomers++;
                gameState.successfulOrders++;
                
                updateRating(customer.satisfaction);
                
                const index = gameState.customers.indexOf(customer);
                if (index > -1) {
                    gameState.customers.splice(index, 1);
                }
                
                showNotification(`Â¥${total.toLocaleString()} ã®å£²ä¸Š`);
            }
        }

        // è©•ä¾¡æ›´æ–°
        function updateRating(satisfaction) {
            const newSatisfaction = (gameState.satisfaction * 0.9) + (satisfaction * 0.1);
            gameState.satisfaction = newSatisfaction;
            
            if (newSatisfaction >= 90) gameState.rating = 5;
            else if (newSatisfaction >= 80) gameState.rating = 4.5;
            else if (newSatisfaction >= 70) gameState.rating = 4;
            else if (newSatisfaction >= 60) gameState.rating = 3.5;
            else if (newSatisfaction >= 50) gameState.rating = 3;
            else if (newSatisfaction >= 40) gameState.rating = 2.5;
            else if (newSatisfaction >= 30) gameState.rating = 2;
            else if (newSatisfaction >= 20) gameState.rating = 1.5;
            else gameState.rating = 1;
        }

        // æ³¨æ–‡ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
        function showOrderPopup(customer) {
            currentOrderCustomer = customer;
            
            const popup = document.getElementById('orderPopup');
            const orderButtons = document.getElementById('orderButtons');
            
            orderButtons.innerHTML = '';
            gameState.selectedMenus.forEach(menu => {
                const button = document.createElement('button');
                button.textContent = `${menu} Â¥${menuData[gameState.storeType][menu].price}`;
                button.onclick = () => addToOrder(menu);
                orderButtons.appendChild(button);
            });
            
            popup.style.display = 'block';
            startOrderTimer();
        }

        // æ³¨æ–‡ã«è¿½åŠ 
        function addToOrder(menu) {
            if (currentOrderCustomer) {
                if (!currentOrderCustomer.order) {
                    currentOrderCustomer.order = [];
                }
                
                const menuDataItem = menuData[gameState.storeType][menu];
                const variant = menuDataItem.variants[0];
                
                currentOrderCustomer.order.push({
                    menu: menu,
                    variant: variant,
                    price: menuDataItem.price
                });
                
                const orderSpeech = document.getElementById('orderSpeech');
                orderSpeech.textContent = currentOrderCustomer.order.map(item => item.menu).join('ã€');
            }
        }

        // æ³¨æ–‡ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹
        function startOrderTimer() {
            const waitTimeElement = document.getElementById('waitTime');
            let seconds = 0;
            
            const timer = setInterval(() => {
                if (!currentOrderCustomer) {
                    clearInterval(timer);
                    return;
                }
                
                seconds++;
                waitTimeElement.textContent = seconds;
                
                if (seconds % 10 === 0) {
                    currentOrderCustomer.satisfaction -= 5;
                    if (currentOrderCustomer.satisfaction < 0) {
                        currentOrderCustomer.satisfaction = 0;
                    }
                }
                
            }, 1000);
        }

        // æ³¨æ–‡å®Œäº†
        function closeOrder() {
            if (currentOrderCustomer && currentOrderCustomer.order && currentOrderCustomer.order.length > 0) {
                currentOrderCustomer.orderTime = Date.now();
                currentOrderCustomer.state = 'cooking';
                
                const cookTime = calculateCookTime(currentOrderCustomer.order);
                setTimeout(() => {
                    serveOrder(currentOrderCustomer);
                }, cookTime);
                
                showNotification('æ³¨æ–‡ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸ');
            } else {
                alert('æ³¨æ–‡ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }
            
            document.getElementById('orderPopup').style.display = 'none';
            currentOrderCustomer = null;
        }

        // ã‚²ãƒ¼ãƒ è¡¨ç¤ºæ›´æ–°
        function updateGameDisplay() {
            document.getElementById('timeDisplay').textContent = 
                `${String(gameState.time.hour).padStart(2, '0')}:${String(gameState.time.minute).padStart(2, '0')} ${weekdays[gameState.time.weekday]}`;
            document.getElementById('moneyDisplay').textContent = `Â¥${gameState.money.toLocaleString()}`;
            document.getElementById('ratingDisplay').textContent = 
                `è©•ä¾¡: ${'â˜…'.repeat(Math.floor(gameState.rating))}${gameState.rating % 1 >= 0.5 ? 'Â½' : ''}`;
            document.getElementById('dayDisplay').textContent = `${gameState.day}æ—¥ç›®`;
            document.getElementById('satisfactionDisplay').textContent = `å¹³å‡æº€è¶³åº¦: ${Math.round(gameState.satisfaction)}%`;
            document.getElementById('dailyProfit').textContent = `æœ¬æ—¥ã®åˆ©ç›Š: Â¥${gameState.dailyProfit.toLocaleString()}`;
            document.getElementById('totalCustomers').textContent = `ç·å®¢æ•°: ${gameState.totalCustomers}`;
            document.getElementById('successRate').textContent = `æˆåŠŸç‡: ${gameState.totalCustomers > 0 ? Math.round((gameState.successfulOrders / gameState.totalCustomers) * 100) : 100}%`;
            
            updateGoalDisplay();
            updateSeatsDisplay();
            updateStaffDisplay();
            updateItemsDisplay();
            updatePromotionDisplay();
        }

        // ç›®æ¨™è¡¨ç¤ºæ›´æ–°
        function updateGoalDisplay() {
            const goalDisplay = document.getElementById('goalDisplay');
            let goalText = '';
            
            switch(gameState.difficulty) {
                case 'easy':
                    goalText = 'ç›®æ¨™: æ¥½ã—ã‚€ã“ã¨ï¼';
                    break;
                case 'normal':
                    goalText = `ç›®æ¨™: Â¥500ä¸‡è²¯ã‚ã‚‹ (ç¾åœ¨: Â¥${(gameState.money - 15000000).toLocaleString()})`;
                    break;
                case 'hard':
                    goalText = `ç›®æ¨™: Â¥1500ä¸‡è²¯ã‚ã‚‹ (ç¾åœ¨: Â¥${(gameState.money - 15000000).toLocaleString()})`;
                    break;
            }
            
            goalDisplay.textContent = goalText;
        }

        // å¸­è¡¨ç¤ºæ›´æ–°
        function updateSeatsDisplay() {
            const seatsContainer = document.getElementById('seatsContainer');
            seatsContainer.innerHTML = '';
            
            for (let i = 0; i < gameState.seats; i++) {
                const seat = document.createElement('div');
                seat.className = 'seat';
                seat.textContent = `å¸­ ${i + 1}`;
                
                const customer = gameState.customers.find(c => c.seatIndex === i);
                if (customer) {
                    if (customer.state === 'waiting') {
                        seat.className += ' waiting';
                        seat.textContent = `å¾…æ©Ÿä¸­\n${customer.groupSize}äºº`;
                    } else {
                        seat.className += ' occupied';
                        seat.textContent = `é£Ÿäº‹ä¸­\n${customer.groupSize}äºº`;
                    }
                } else {
                    seat.className += ' available';
                    seat.textContent = `ç©ºå¸­\n0äºº`;
                }
                
                seatsContainer.appendChild(seat);
            }
        }

        // å¾“æ¥­å“¡è¡¨ç¤ºæ›´æ–°
        function updateStaffDisplay() {
            const staffInfo = document.getElementById('staffInfo');
            
            if (gameState.staff.length === 0) {
                staffInfo.innerHTML = '<p>å¾“æ¥­å“¡ãŒã„ã¾ã›ã‚“</p>';
            } else {
                staffInfo.innerHTML = gameState.staff.map(staff => `
                    <div class="staff-member">
                        <strong>${staffData[staff.type].name}</strong><br>
                        é€Ÿåº¦: ${staffData[staff.type].speed}å€<br>
                        çµ¦æ–™: Â¥${staff.salary.toLocaleString()}
                    </div>
                `).join('');
            }
        }

        // ã‚¢ã‚¤ãƒ†ãƒ è¡¨ç¤ºæ›´æ–°
        function updateItemsDisplay() {
            const itemsInfo = document.getElementById('itemsInfo');
            
            if (gameState.items.length === 0) {
                itemsInfo.innerHTML = '<p>ã‚¢ã‚¤ãƒ†ãƒ ãŒã‚ã‚Šã¾ã›ã‚“</p>';
            } else {
                itemsInfo.innerHTML = gameState.items.map(item => `
                    <div class="item-owned">
                        <strong>${item.name}</strong><br>
                        ${item.description}
                    </div>
                `).join('');
            }
        }

        // å®£ä¼åŠ¹æœè¡¨ç¤ºæ›´æ–°
        function updatePromotionDisplay() {
            const promotionEffects = document.getElementById('promotionEffects');
            
            if (gameState.promotions.length === 0) {
                promotionEffects.innerHTML = '<p>åŠ¹æœã¯ã‚ã‚Šã¾ã›ã‚“</p>';
            } else {
                promotionEffects.innerHTML = gameState.promotions.map(promo => `
                    <div class="promotion-effect">
                        <strong>${getPromotionName(promo.type)}</strong><br>
                        æ®‹ã‚Š: ${promo.duration}æ—¥
                    </div>
                `).join('');
            }
        }

        // å®£ä¼åå–å¾—
        function getPromotionName(type) {
            const names = {
                poster: 'ãƒã‚¹ã‚¿ãƒ¼',
                flyer: 'ãƒãƒ©ã‚·',
                cm: 'CMæ”¾é€',
                tv: 'ãƒ†ãƒ¬ãƒ“ç•ªçµ„'
            };
            return names[type] || type;
        }

        // å®£ä¼åŠ¹æœæ›´æ–°
        function updatePromotions() {
            gameState.promotions.forEach(promo => {
                if (promo.active) {
                    promo.duration--;
                    if (promo.duration <= 0) {
                        const index = gameState.promotions.indexOf(promo);
                        if (index > -1) {
                            gameState.promotions.splice(index, 1);
                        }
                    }
                }
            });
        }

        // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ¡ãƒ‹ãƒ¥ãƒ¼
        function toggleMenu() {
            const menu = document.getElementById('popupMenu');
            menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
        }

        function toggleSettings() {
            const settings = document.getElementById('settingsMenu');
            settings.style.display = settings.style.display === 'none' ? 'block' : 'none';
        }

        function showSettings() {
            toggleMenu();
            toggleSettings();
        }

        // è¨­å®šé©ç”¨
        function applySettings() {
            const gameSpeed = parseInt(document.getElementById('gameSpeed').value);
            
            if (gameSpeed !== gameState.gameSpeed) {
                gameState.gameSpeed = gameSpeed;
                startGameLoop();
            }
            
            toggleSettings();
            showNotification('è¨­å®šã‚’é©ç”¨ã—ã¾ã—ãŸ');
        }

        // ä¸€æ™‚åœæ­¢
        function togglePause() {
            gameState.isPaused = !gameState.isPaused;
            document.getElementById('pauseBtn').textContent = 
                gameState.isPaused ? 'å†é–‹' : 'ä¸€æ™‚åœæ­¢';
            showNotification(gameState.isPaused ? 'ä¸€æ™‚åœæ­¢ä¸­' : 'ã‚²ãƒ¼ãƒ å†é–‹');
        }

        // ã‚¢ã‚¤ãƒ†ãƒ ã‚·ãƒ§ãƒƒãƒ—
        function showItemShop() {
            document.getElementById('itemShop').style.display = 'block';
        }

        function closeItemShop() {
            document.getElementById('itemShop').style.display = 'none';
        }

        function buyItem(itemType) {
            let cost, item;
            
            switch(itemType) {
                case 'trashBin':
                    cost = 10000;
                    item = { type: 'trashBin', name: 'ã‚´ãƒŸç®±', description: 'å®¢ã®æº€è¶³åº¦ãŒå‘ä¸Š' };
                    break;
                case 'cleaning':
                    cost = 50000;
                    item = { type: 'cleaning', name: 'æ¸…æƒä½œæ¥­', description: 'åº—ã®è©•ä¾¡ãŒ0.2å‘ä¸Š' };
                    gameState.rating = Math.min(5, gameState.rating + 0.2);
                    break;
                default:
                    return;
            }
            
            if (gameState.money >= cost) {
                gameState.money -= cost;
                gameState.items.push(item);
                showNotification(`${item.name}ã‚’è³¼å…¥ã—ã¾ã—ãŸ`);
                closeItemShop();
            } else {
                alert('è³‡é‡‘ãŒè¶³ã‚Šã¾ã›ã‚“');
            }
        }

        // å®£ä¼æ´»å‹•
        function showPromotionMenu() {
            document.getElementById('promotionMenu').style.display = 'block';
        }

        function closePromotionMenu() {
            document.getElementById('promotionMenu').style.display = 'none';
        }

        function startPromotion(type) {
            let cost, duration;
            
            switch(type) {
                case 'poster':
                    cost = 7000;
                    duration = 2;
                    break;
                case 'flyer':
                    cost = 10000;
                    duration = 2;
                    break;
                case 'cm':
                    cost = 50000;
                    duration = 10;
                    break;
                case 'tv':
                    cost = 100000;
                    duration = 1;
                    break;
                default:
                    return;
            }
            
            if (gameState.money >= cost) {
                gameState.money -= cost;
                gameState.promotions.push({
                    type: type,
                    active: true,
                    duration: duration
                });
                showNotification(`${getPromotionName(type)}ã‚’é–‹å§‹ã—ã¾ã—ãŸ`);
                closePromotionMenu();
            } else {
                alert('è³‡é‡‘ãŒè¶³ã‚Šã¾ã›ã‚“');
            }
        }

        // å¾“æ¥­å“¡é›‡ç”¨
        function hireStaff() {
            document.getElementById('staffHire').style.display = 'block';
        }

        function closeStaffHire() {
            document.getElementById('staffHire').style.display = 'none';
        }

        function hireStaffType(type) {
            const staff = staffData[type];
            
            if (gameState.money >= staff.hireCost) {
                gameState.money -= staff.hireCost;
                gameState.staff.push({
                    type: type,
                    salary: staff.salary
                });
                showNotification(`${staff.name}ã‚’é›‡ç”¨ã—ã¾ã—ãŸ`);
                closeStaffHire();
            } else {
                alert('è³‡é‡‘ãŒè¶³ã‚Šã¾ã›ã‚“');
            }
        }

        // ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿
        function toggleMode() {
            gameState.isMobileMode = !gameState.isMobileMode;
            updateDisplayMode();
        }

        function updateDisplayMode() {
            const body = document.body;
            const toggleBtn = document.getElementById('modeToggle');
            
            if (gameState.isMobileMode) {
                body.classList.add('mobile-mode');
                toggleBtn.textContent = 'ã‚¹ãƒãƒ›ãƒ¢ãƒ¼ãƒ‰';
            } else {
                body.classList.remove('mobile-mode');
                toggleBtn.textContent = 'PCãƒ¢ãƒ¼ãƒ‰';
            }
        }

        // é€šçŸ¥è¡¨ç¤º
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // ã‚²ãƒ¼ãƒ çµ‚äº†
        function exitGame() {
            if (confirm('ã‚²ãƒ¼ãƒ ã‚’çµ‚äº†ã—ã¾ã™ã‹ï¼Ÿ\nçµ‚äº†å‰ã«ã‚»ãƒ¼ãƒ–ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚')) {
                returnToHome();
            }
        }

        function returnToHome() {
            if (gameInterval) clearInterval(gameInterval);
            showScreen('home');
        }

        function continuePlaying() {
            document.getElementById('gameClear').style.display = 'none';
        }

        // ã‚²ãƒ¼ãƒ æ¡ä»¶ãƒã‚§ãƒƒã‚¯
        function checkGameConditions() {
            if (gameState.difficulty === 'hard' && gameState.rating < 3.5) {
                gameOver('è©•ä¾¡ãŒ3.5ã‚’ä¸‹å›ã£ãŸãŸã‚ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã§ã™');
                return;
            }
            
            if (gameState.money < 0) {
                gameOver('è³‡é‡‘ãŒå°½ãã¦ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã§ã™');
                return;
            }
            
            const profit = gameState.money - 15000000;
            if (gameState.difficulty === 'normal' && profit >= 5000000) {
                gameClear(`Â¥500ä¸‡ã®è²¯é‡‘ã‚’é”æˆï¼\næœ€çµ‚åˆ©ç›Š: Â¥${profit.toLocaleString()}`);
            } else if (gameState.difficulty === 'hard' && profit >= 15000000) {
                gameClear(`Â¥1500ä¸‡ã®è²¯é‡‘ã‚’é”æˆï¼\næœ€çµ‚åˆ©ç›Š: Â¥${profit.toLocaleString()}`);
            }
        }

        function gameOver(message) {
            document.getElementById('gameOverMessage').textContent = message;
            document.getElementById('gameOver').style.display = 'block';
            gameState.isPaused = true;
        }

        function gameClear(message) {
            document.getElementById('clearMessage').textContent = message;
            document.getElementById('gameClear').style.display = 'block';
            gameState.isPaused = true;
        }

        // ã‚»ãƒ¼ãƒ–æ©Ÿèƒ½
        function saveGame() {
            const saveData = JSON.stringify(gameState);
            const blob = new Blob([saveData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `restaurant_save_${new Date().toISOString().slice(0, 19)}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
            showNotification('ã‚²ãƒ¼ãƒ ã‚’ã‚»ãƒ¼ãƒ–ã—ã¾ã—ãŸ');
        }

        function loadGame() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const loadedState = JSON.parse(e.target.result);
                            gameState = loadedState;
                            
                            if (gameInterval) clearInterval(gameInterval);
                            showScreen('game');
                            startGameLoop();
                            updateGameDisplay();
                            
                            showNotification('ã‚²ãƒ¼ãƒ ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ');
                        } catch (error) {
                            alert('ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            
            input.click();
        }

        // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºå¯¾å¿œ
        window.addEventListener('resize', function() {
            gameState.isMobileMode = window.innerWidth < 768;
            updateDisplayMode();
        });
    </script>
</body>
</html>
